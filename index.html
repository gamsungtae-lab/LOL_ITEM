<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL ì•„ì´í…œ ì—°êµ¬ì†Œ V7.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { background-color: #091428; color: #f0e6d2; font-family: 'Pretendard', sans-serif; text-align: center; padding: 20px; margin: 0; }
        h1 { margin-bottom: 5px; color: #c8aa6e; }

        /* ìŠ¬ë¼ì´ë” ë””ìì¸ */
        .smart-builder {
            background: rgba(16, 28, 45, 0.95); border: 1px solid #c8aa6e; border-radius: 8px;
            padding: 20px; max-width: 800px; margin: 20px auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .slider-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; }
        .slider-label { display: flex; justify-content: space-between; color: #a09b8c; font-size: 14px; margin-bottom: 5px; }
        .slider-label span:last-child { color: #c8aa6e; font-weight: bold; }
        input[type=range] { width: 100%; height: 6px; background: #333; border-radius: 3px; outline: none; -webkit-appearance: none; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #c8aa6e; border-radius: 50%; cursor: pointer; }
        
        .generate-btn {
            background: linear-gradient(180deg, #c8aa6e 0%, #a1834a 100%); color: #091428; font-weight: bold; font-size: 16px;
            border: none; padding: 12px 40px; border-radius: 4px; cursor: pointer; margin-top: 25px; width: 100%;
        }

        /* ì¸ë²¤í† ë¦¬ */
        .inventory-box { display: flex; justify-content: center; gap: 8px; margin-bottom: 30px; }
        .slot { width: 60px; height: 60px; background: #010a13; border: 2px solid #3c3c41; border-radius: 4px; display: flex; align-items: center; justify-content: center; position: relative; }
        .slot img { width: 100%; height: 100%; border-radius: 4px; cursor: pointer; }
        .slot:hover { border-color: #c8aa6e; }

        /* ê²°ê³¼ ë¶„ì„ */
        .analysis-box { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; max-width: 900px; margin: 0 auto; }
        .table-container { flex: 1; min-width: 300px; background: #111; border: 1px solid #444; padding: 15px; border-radius: 8px; }
        .stat-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .stat-table td { padding: 6px; border-bottom: 1px solid #222; text-align: right; color: #f0e6d2; }
        .stat-table .label { text-align: left; color: #888; }
        .highlight { color: #00d2d3; font-weight: bold; }

        /* í•„í„° */
        .filter-tabs { margin: 30px 0 15px; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
        .tab-btn { background: #222; border: 1px solid #444; color: #888; padding: 8px 16px; cursor: pointer; border-radius: 20px; }
        .tab-btn.active { background: #c8aa6e; color: #000; border-color: #c8aa6e; font-weight: bold; }
        
        .item-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; max-width: 1000px; margin: 0 auto 50px; }
        .item-card { width: 48px; height: 48px; cursor: pointer; border: 1px solid #333; overflow: hidden; border-radius: 4px; }
        .item-card:hover { border-color: #c8aa6e; transform: scale(1.1); z-index: 10; }
        .item-card img { width: 100%; height: 100%; }

        /* íˆ´íŒ */
        #tooltip {
            position: fixed; display: none; background: rgba(5, 12, 20, 0.98); 
            border: 1px solid #c8aa6e; color: #a0a0a0; padding: 15px; width: 280px; 
            text-align: left; z-index: 1000; pointer-events: none; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.9); font-size: 12px; line-height: 1.4; border-radius: 6px;
        }
        #tooltip h3 { color: #c8aa6e; margin: 0 0 5px 0; font-size: 14px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        #tooltip .stat-val { color: #fff; font-weight: bold; float: right; }
        #tooltip .desc { margin-top: 10px; color: #ccc; display: block; border-top: 1px dashed #444; padding-top: 5px; }
    </style>
</head>
<body>

    <h1>âš–ï¸ LoL ì•„ì´í…œ ì—°êµ¬ì†Œ <span style="font-size:0.6em; color:#555;">V7.0 Logic</span></h1>
    <div id="tooltip"></div>

    <div class="smart-builder">
        <div class="slider-grid">
            <div class="slider-group"><div class="slider-label"><span>âš”ï¸ ê³µê²©ë ¥ (AD)</span> <span id="val_ad">0</span></div><input type="range" id="range_ad" min="0" max="10" value="0" oninput="upd('val_ad', this.value)"></div>
            <div class="slider-group"><div class="slider-label"><span>ğŸ”® ì£¼ë¬¸ë ¥ (AP)</span> <span id="val_ap">0</span></div><input type="range" id="range_ap" min="0" max="10" value="0" oninput="upd('val_ap', this.value)"></div>
            <div class="slider-group"><div class="slider-label"><span>ğŸ›¡ï¸ ë°©ì–´ë ¥</span> <span id="val_armor">0</span></div><input type="range" id="range_armor" min="0" max="10" value="0" oninput="upd('val_armor', this.value)"></div>
            <div class="slider-group"><div class="slider-label"><span>ğŸ’š ì²´ë ¥</span> <span id="val_hp">0</span></div><input type="range" id="range_hp" min="0" max="10" value="0" oninput="upd('val_hp', this.value)"></div>
            <div class="slider-group"><div class="slider-label"><span>âš¡ ê³µê²© ì†ë„</span> <span id="val_as">0</span></div><input type="range" id="range_as" min="0" max="10" value="0" oninput="upd('val_as', this.value)"></div>
            <div class="slider-group"><div class="slider-label"><span style="color:#00d2d3">â³ ìŠ¤í‚¬ ê°€ì†</span> <span id="val_ah" style="color:#00d2d3">0</span></div><input type="range" id="range_ah" min="0" max="10" value="0" oninput="upd('val_ah', this.value)"></div>
        </div>
        <button class="generate-btn" onclick="autoBuild()">ğŸ” ìŠ¤ë§ˆíŠ¸ ì¡°í•© ì—°êµ¬ ì‹œì‘</button>
    </div>

    <div class="inventory-box">
        <div class="slot" onclick="rm(0)"></div><div class="slot" onclick="rm(1)"></div>
        <div class="slot" onclick="rm(2)"></div><div class="slot" onclick="rm(3)"></div>
        <div class="slot" onclick="rm(4)"></div><div class="slot" onclick="rm(5)"></div>
    </div>

    <div class="analysis-box">
        <div class="table-container">
            <div style="margin-bottom:10px; color:#aaa;">ì´ ê°€ê²©: <span id="totalPrice" style="color:#ffd700; font-weight:bold;">0 G</span></div>
            <table class="stat-table"><tbody id="statBody"></tbody></table>
        </div>
        <div style="width:300px; height:300px; background:#010a13; padding:10px; border:1px solid #333; border-radius:8px;">
            <canvas id="statChart"></canvas>
        </div>
    </div>

    <div class="filter-tabs">
        <button class="tab-btn active" onclick="filter('all')">ì „ì²´</button>
        <button class="tab-btn" onclick="filter('Damage')">ë¬¼ë¦¬</button>
        <button class="tab-btn" onclick="filter('SpellDamage')">ë§ˆë²•</button>
        <button class="tab-btn" onclick="filter('Defense')">ë°©ì–´/íƒ±</button>
        <button class="tab-btn" onclick="filter('Support')">ì„œí¿</button>
        <button class="tab-btn" onclick="filter('Boots')">ì‹ ë°œ</button>
    </div>
    <div class="item-list" id="itemList"></div>

    <script>
        // âœ… ëª©ì‚¬ë‹˜ì˜ ì‹œíŠ¸ ì£¼ì†Œ
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRP5NKa1wd_e47A5CT5klukKhbDPluILcBMObpJUyhPNNnd5rmMXpWSUfIFdmA4T_2BFxHF8dS7bkfU/pub?gid=0&single=true&output=csv";

        let allItems=[], display=[], inv=[null,null,null,null,null,null], radar;

        // ğŸŸ¢ 1. ì•„ì´í…œ ê·¸ë£¹ ì •ì˜ (ê·œì¹™ì„± ë¶€ì—¬)
        // ì—¬ê¸°ì— ë“±ë¡ëœ ì•„ì´í…œë“¤ì€ ì„œë¡œ ì¤‘ë³µí•´ì„œ ì°©ìš©í•  ìˆ˜ ì—†ìŒ
        const UNIQUE_GROUPS = {
            'LastWhisper': ['ë„ë¯¸ë‹‰ ê²½ì˜ ì¸ì‚¬', 'ì„¸ë¦´ë‹¤ì˜ ì›í•œ', 'í•„ë©¸ìì˜ ìš´ëª…', 'ê²½ê³„', 'ì¹ í‘ì˜ ì–‘ë‚  ë„ë¼'], // ë°©ê´€/ë§ˆê´€
            'VoidPen': ['ê³µí—ˆì˜ ì§€íŒ¡ì´', 'ë¬´ë¤ê½ƒ', 'ì•”í˜¸í™”ëœ íŒŒí¸'], // ë§ˆê´€
            'Lifeline': ['ìŠ¤í…Œë½ì˜ ë„ì „', 'ë§¬ëª¨ì…”ìŠ¤ì˜ ì•„ê·€', 'ë¶ˆë©¸ì˜ ì² ê°‘ê¶'], // ìƒëª…ì„ 
            'CritModifier': ['ë¬´í•œì˜ ëŒ€ê²€', 'ë‚˜ë³´ë¦¬ ëª…ë©¸ê²€', 'êµ¬ì¸ìˆ˜ì˜ ê²©ë…¸ê²€'], // ì¹˜ëª…íƒ€ ë³€í˜•
            'Tear': ['ë¬´ë¼ë§ˆë‚˜', 'ë§ˆë‚˜ë¬´ë„¤', 'ëŒ€ì²œì‚¬ì˜ í¬ì˜¹', 'ëŒ€ì²œì‚¬ì˜ ì§€íŒ¡ì´', 'ì¢…ë§ì˜ ê²¨ìš¸', 'í˜¹í•œì˜ ì†ê¸¸'], // ì—¬ëˆˆ
            'Hydra': ['êµ¶ì£¼ë¦° íˆë“œë¼', 'ê±°ëŒ€í•œ íˆë“œë¼', 'ë¶ˆê²½í•œ íˆë“œë¼', 'ì‹¤í—˜ì  ë§ˆê³µí•™íŒ'] // íˆë“œë¼ë¥˜
        };

        Papa.parse(SHEET_URL, { download:true, header:true, dynamicTyping:true, complete: res => {
            allItems = res.data.filter(i => i.name).map(i => {
                i.ah = Number(i.ah)||0; // ì¿¨ê° ìˆ«ì ë³´ì •
                return i;
            });
            display = allItems;
            render();
        }});

        // ğŸŸ¢ 2. ìŠ¤ë§ˆíŠ¸ ë¹Œë“œ ì•Œê³ ë¦¬ì¦˜ (ë…¼ë¦¬ ì—”ì§„)
        function autoBuild() {
            const w = {
                ad: parseInt(document.getElementById('range_ad').value),
                ap: parseInt(document.getElementById('range_ap').value),
                armor: parseInt(document.getElementById('range_armor').value),
                hp: parseInt(document.getElementById('range_hp').value),
                as: parseInt(document.getElementById('range_as').value),
                ah: parseInt(document.getElementById('range_ah').value)
            };

            // ì ìˆ˜ ê³„ì‚° (ê°€ì¹˜ ê¸°ë°˜)
            const calc = (i) => {
                let s = 0;
                // ê³¨ë“œ ê°€ì¹˜ ëŒ€ì… (ê³µê²©/ë°©ì–´ ë°¸ëŸ°ìŠ¤ ì¡°ì •)
                if(i.ad) s += i.ad * 40 * w.ad;
                if(i.ap) s += i.ap * 25 * w.ap;
                if(i.hp) s += i.hp * 2.8 * w.hp; 
                if(i.armor) s += i.armor * 22 * w.armor;
                if(i.mr) s += i.mr * 20 * w.armor; 
                if(i.as) s += (i.as*100) * 35 * w.as;
                if(i.ah) s += i.ah * 60 * w.ah; // ì¿¨ê° ê°€ì¹˜ ìµœìš°ì„ 
                
                // [ê·œì¹™] ë°©ì–´ë ¥(Tank)ë¥¼ ì›í•˜ëŠ”ë° ë”œí…œë§Œ ë‚˜ì˜¤ì§€ ì•Šê²Œ
                if (w.armor > 5 && i.armor === 0 && i.mr === 0 && i.hp === 0) s -= 5000;
                // [ê·œì¹™] ADë¥¼ ì›í•˜ëŠ”ë° APí…œ ë‚˜ì˜¤ì§€ ì•Šê²Œ
                if (w.ad > 5 && i.ad === 0) s -= 2000;
                if (w.ap > 5 && i.ap === 0) s -= 2000;

                return s;
            };

            let pool = allItems.filter(i => i.category !== "Boots")
                               .map(i => ({...i, score: calc(i)}))
                               .sort((a,b) => b.score - a.score);

            // ì‹ ë°œ ê²°ì •
            let boot = "íŒê¸ˆ ì¥í™”";
            if(w.ap > w.ad) boot = "ë§ˆë²•ì‚¬ì˜ ì‹ ë°œ";
            if(w.as > 5 || (w.ad > 7 && w.crit > 5)) boot = "ê´‘ì „ì‚¬ì˜ êµ°í™”";
            if(w.ah > 5) boot = "ëª…ì„í•¨ì˜ ì•„ì´ì˜¤ë‹ˆì•„ ì¥í™”";
            if(w.hp > 6) boot = "í—¤ë¥´ë©”ìŠ¤ì˜ ë°œê±¸ìŒ"; 

            // ğŸŸ¢ 3. ì„ íƒ ë° ì¤‘ë³µ ê²€ì‚¬ (í•µì‹¬ ë¡œì§)
            inv = [null,null,null,null,null,null];
            let names = new Set();
            let groups = new Set(); // ì ìš©ëœ ìœ ë‹ˆí¬ ê·¸ë£¹

            // ì‹ ë°œ ì¥ì°©
            let bObj = allItems.find(i => i.name === boot);
            if(bObj) { inv[5] = bObj; names.add(bObj.name); }

            let idx = 0;
            for(let item of pool) {
                if(idx >= 5) break;
                if(names.has(item.name)) continue; // ì´ë¯¸ ìˆëŠ” í…œ

                // [ìœ ë‹ˆí¬ ê·¸ë£¹ ê²€ì‚¬]
                let conflict = false;
                for (const [gName, members] of Object.entries(UNIQUE_GROUPS)) {
                    if (members.includes(item.name)) {
                        if (groups.has(gName)) {
                            conflict = true; // ì´ë¯¸ ê°™ì€ ê·¸ë£¹ í…œì´ ìˆìŒ -> íŒ¨ìŠ¤
                        } else {
                            // ì•„ì§ ì—†ìœ¼ë©´ ì´ ê·¸ë£¹ì„ ì°œí•¨ (ë‚˜ì¤‘ì— ì¶”ê°€í•  ë•Œ ë°˜ì˜)
                            // ì£¼ì˜: ì—¬ê¸°ì„œ ë°”ë¡œ ì¶”ê°€í•˜ë©´ ì•ˆë˜ê³ , í™•ì •ë  ë•Œ ì¶”ê°€í•´ì•¼ í•¨
                        }
                    }
                }
                if (conflict) continue;

                // í†µê³¼í–ˆìœ¼ë©´ ì¥ì°©
                inv[idx++] = item;
                names.add(item.name);
                
                // ê·¸ë£¹ ì¥ë¶€ ì—…ë°ì´íŠ¸
                for (const [gName, members] of Object.entries(UNIQUE_GROUPS)) {
                    if (members.includes(item.name)) groups.add(gName);
                }
            }
            update();
        }

        function update() {
            let gold=0, s={ad:0, ap:0, hp:0, armor:0, mr:0, as:0, ah:0, crit:0};
            inv.forEach((i, idx) => {
                const el = document.querySelectorAll('.slot')[idx];
                el.innerHTML = i ? `<img src="${i.img}" onmouseenter="tip(inv[${idx}], event)" onmousemove="move(event)" onmouseleave="hide()">` : "";
                if(i) {
                    gold += i.gold;
                    s.ad+=i.ad||0; s.ap+=i.ap||0; s.hp+=i.hp||0; s.armor+=i.armor||0;
                    s.mr+=i.mr||0; s.as+=i.as||0; s.ah+=i.ah||0; s.crit+=i.crit||0;
                }
            });
            document.getElementById("totalPrice").innerText = gold.toLocaleString() + " G";
            
            let h = "";
            if(s.ad) h += `<tr><td class="label">ê³µê²©ë ¥</td><td>+${s.ad}</td></tr>`;
            if(s.ap) h += `<tr><td class="label">ì£¼ë¬¸ë ¥</td><td>+${s.ap}</td></tr>`;
            if(s.as) h += `<tr><td class="label">ê³µê²©ì†ë„</td><td>+${(s.as*100).toFixed(0)}%</td></tr>`;
            if(s.crit) h += `<tr><td class="label">ì¹˜ëª…íƒ€</td><td>+${(s.crit*100).toFixed(0)}%</td></tr>`;
            if(s.ah) h += `<tr><td class="label highlight">ìŠ¤í‚¬ ê°€ì†</td><td class="highlight">+${s.ah} (ì¿¨ê° ${Math.floor(s.ah/(s.ah+100)*100)}%)</td></tr>`;
            if(s.hp) h += `<tr><td class="label">ì²´ë ¥</td><td>+${s.hp}</td></tr>`;
            if(s.armor) h += `<tr><td class="label">ë°©ì–´ë ¥</td><td>+${s.armor}</td></tr>`;
            if(s.mr) h += `<tr><td class="label">ë§ˆë²•ì €í•­</td><td>+${s.mr}</td></tr>`;
            
            document.getElementById("statBody").innerHTML = h || "<tr><td colspan='2' style='text-align:center;color:#555'>ì•„ì´í…œ ì—†ìŒ</td></tr>";
            chart(s);
        }

        const tt = document.getElementById('tooltip');
        window.tip = (i, e) => {
            let desc = i.description ? `<span class="desc">${i.description}</span>` : "";
            let info = "";
            if(i.ad) info += `<div>ê³µê²©ë ¥ +${i.ad}</div>`;
            if(i.ap) info += `<div>ì£¼ë¬¸ë ¥ +${i.ap}</div>`;
            if(i.ah) info += `<div style="color:#00d2d3">ìŠ¤í‚¬ê°€ì† +${i.ah}</div>`;
            if(i.armor) info += `<div>ë°©ì–´ë ¥ +${i.armor}</div>`;
            if(i.hp) info += `<div>ì²´ë ¥ +${i.hp}</div>`;
            
            tt.innerHTML = `<h3>${i.name}</h3><span class="gold">${i.gold} G</span><br>${info}${desc}`;
            tt.style.display = 'block'; move(e);
        }
        window.move = e => { tt.style.left = (e.clientX+15)+'px'; tt.style.top = (e.clientY+15)+'px'; }
        window.hide = () => { tt.style.display = 'none'; }

        window.upd = (id, v) => document.getElementById(id).innerText = v;
        window.rm = idx => { inv[idx]=null; update(); };
        window.addItem = i => { 
            let empty = inv.indexOf(null);
            if(empty !== -1) { inv[empty] = i; update(); }
        };
        window.filter = c => {
            document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
            event.target.classList.add('active');
            display = c==='all' ? allItems : allItems.filter(i=>i.category===c);
            render();
        };
        window.searchItems = () => {
            let k = document.getElementById("search").value;
            display = allItems.filter(i=>i.name.includes(k));
            render();
        };
        function render() {
            const l = document.getElementById("itemList"); l.innerHTML = "";
            display.forEach(i => {
                l.innerHTML += `<div class="item-card" onclick='addItem(${JSON.stringify(i)})' onmouseenter='tip(${JSON.stringify(i)}, event)' onmousemove='move(event)' onmouseleave='hide()'><img src="${i.img}"></div>`;
            });
        }
        function chart(s) {
            const ctx = document.getElementById('statChart').getContext('2d');
            const data = [s.ad, s.ap, s.hp/10, s.armor, s.mr, s.as*100];
            if(radar) { radar.data.datasets[0].data = data; radar.update(); }
            else radar = new Chart(ctx, {
                type: 'radar',
                data: { labels: ['ê³µê²©', 'ì£¼ë¬¸', 'ì²´ë ¥/10', 'ë°©ì–´', 'ë§ˆë°©', 'ê³µì†'], datasets: [{ label: 'Stat', data, backgroundColor: 'rgba(200,170,110,0.2)', borderColor: '#c8aa6e', pointBackgroundColor: '#fff' }] },
                options: { scales: { r: { grid: { color: '#333' }, ticks: { display: false } } }, plugins: { legend: { display: false } } }
            });
        }
        
        init();
    </script>
</body>
</html>
