<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL ì•„ì´í…œ ì—°êµ¬ì†Œ (Final)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* [í…Œë§ˆ: ë‹¤í¬ ë„¤ì´ë¹„ & ê³¨ë“œ] */
        body { 
            background-color: #091428; color: #f0e6d2; 
            font-family: 'Pretendard', sans-serif; text-align: center; 
            padding: 20px; margin: 0;
        }

        h1 { margin-bottom: 5px; color: #c8aa6e; text-shadow: 0 0 10px rgba(200, 170, 110, 0.5); }
        
        /* --- 1. ìŠ¤ë§ˆíŠ¸ íƒœê·¸ ì„ íƒê¸° (ìŠ¬ë¼ì´ë” ëŒ€ì²´) --- */
        .smart-builder {
            background: rgba(16, 28, 45, 0.95);
            border: 1px solid #444; border-radius: 12px;
            padding: 25px; max-width: 600px; margin: 20px auto 40px auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .builder-title { font-size: 1.1em; font-weight: bold; margin-bottom: 15px; display: block; color: #fff; }
        
        .tag-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px; }
        
        /* íƒœê·¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .stat-tag {
            padding: 10px 20px; border-radius: 25px; border: 2px solid #444;
            background: #1e2328; color: #888; font-weight: bold; cursor: pointer;
            transition: 0.2s; user-select: none;
        }
        .stat-tag:hover { border-color: #c8aa6e; color: #c8aa6e; }
        
        /* ì„ íƒëœ íƒœê·¸ (í™œì„±í™”) */
        .stat-tag.active { 
            background: #c8aa6e; color: #091428; border-color: #c8aa6e; 
            box-shadow: 0 0 10px rgba(200, 170, 110, 0.5);
        }
        /* ìŠ¤í‚¬ê°€ì† ì „ìš© ì»¬ëŸ¬ */
        .stat-tag[data-stat="ah"].active { background: #00d2d3; color: #000; border-color: #00d2d3; box-shadow: 0 0 10px rgba(0, 210, 211, 0.5); }

        .generate-btn {
            background: linear-gradient(180deg, #c8aa6e 0%, #a1834a 100%);
            color: #091428; font-weight: bold; font-size: 18px;
            border: none; padding: 12px 50px; border-radius: 8px; 
            cursor: pointer; transition: 0.2s;
        }
        .generate-btn:hover { filter: brightness(1.1); transform: scale(1.05); }

        /* --- 2. ì¸ë²¤í† ë¦¬ --- */
        .inventory-box { display: flex; justify-content: center; gap: 8px; margin-bottom: 30px; }
        .slot { 
            width: 60px; height: 60px; background: #010a13; border: 2px solid #3c3c41; 
            border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative;
        }
        .slot img { width: 100%; height: 100%; border-radius: 4px; }
        .slot:hover { border-color: #c8aa6e; box-shadow: 0 0 15px rgba(200, 170, 110, 0.3); }

        /* --- 3. í†µê³„ í‘œ --- */
        .analysis-box { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; max-width: 900px; margin: 0 auto; }
        .table-container { flex: 1; min-width: 300px; background: #111; border: 1px solid #444; padding: 15px; border-radius: 8px; }
        .stat-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .stat-table td { padding: 8px; border-bottom: 1px solid #222; text-align: right; color: #f0e6d2; font-weight: bold; }
        .stat-table .label { text-align: left; color: #888; font-weight: normal; }
        .stat-table .highlight { color: #00d2d3; font-weight: 900; } /* ìŠ¤í‚¬ê°€ì† ê°•ì¡° */

        /* --- 4. í•˜ë‹¨ ë¦¬ìŠ¤íŠ¸ --- */
        .filter-tabs { margin: 40px 0 15px 0; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
        .tab-btn { background: #111; border: 1px solid #444; color: #888; padding: 8px 15px; cursor: pointer; border-radius: 20px; font-size: 13px; }
        .tab-btn.active { background: #c8aa6e; color: #000; border-color: #c8aa6e; font-weight: bold; }
        
        .search-box input { padding: 10px; width: 300px; background: #010a13; border: 1px solid #444; color: white; text-align: center; margin-bottom: 20px; outline: none; border-radius: 5px; }
        
        .item-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; max-width: 1000px; margin: 0 auto 50px auto; }
        .item-card { width: 48px; height: 48px; cursor: pointer; border: 1px solid #333; overflow: hidden; border-radius: 5px; }
        .item-card:hover { border-color: #c8aa6e; transform: scale(1.15); z-index: 10; }
        .item-card img { width: 100%; height: 100%; }

        /* íˆ´íŒ */
        #tooltip { position: fixed; display: none; background: rgba(5, 12, 20, 0.98); border: 2px solid #c8aa6e; color: #a0a0a0; padding: 15px; width: 260px; text-align: left; z-index: 1000; pointer-events: none; box-shadow: 0 10px 30px rgba(0,0,0,0.8); font-size: 12px; line-height: 1.5; border-radius: 8px; }
        #tooltip h3 { color: #c8aa6e; margin: 0 0 5px 0; font-size: 15px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        #tooltip .stat-row { display: flex; justify-content: space-between; color: #ddd; }
    </style>
</head>
<body>

    <h1>âš–ï¸ LoL ì•„ì´í…œ ì—°êµ¬ì†Œ <span style="font-size:0.6em; color:#555;">(V5.0)</span></h1>
    <div id="tooltip"></div>

    <div class="smart-builder">
        <span class="builder-title">ğŸ¯ ì›í•˜ëŠ” ëŠ¥ë ¥ì¹˜ë¥¼ ëª¨ë‘ ëˆ„ë¥´ì„¸ìš” (ì¤‘ë³µ ê°€ëŠ¥)</span>
        <div class="tag-container">
            <div class="stat-tag" onclick="toggleTag(this)" data-stat="ad">âš”ï¸ ë¬¼ë¦¬ê³µê²©</div>
            <div class="stat-tag" onclick="toggleTag(this)" data-stat="ap">ğŸ”® ì£¼ë¬¸ë ¥</div>
            <div class="stat-tag" onclick="toggleTag(this)" data-stat="as">âš¡ ê³µê²©ì†ë„</div>
            <div class="stat-tag" onclick="toggleTag(this)" data-stat="crit">ğŸ’¥ ì¹˜ëª…íƒ€</div>
            <div class="stat-tag" onclick="toggleTag(this)" data-stat="tank">ğŸ›¡ï¸ ë°©ì–´/ì²´ë ¥</div>
            <div class="stat-tag" onclick="toggleTag(this)" data-stat="ah">â³ ìŠ¤í‚¬ê°€ì†(ì¿¨ê°)</div>
        </div>
        <button class="generate-btn" onclick="autoGenerateBuild()">ìë™ ì¡°í•© ìƒì„±</button>
    </div>

    <div class="inventory-box">
        <div class="slot" onclick="removeItem(0)"></div>
        <div class="slot" onclick="removeItem(1)"></div>
        <div class="slot" onclick="removeItem(2)"></div>
        <div class="slot" onclick="removeItem(3)"></div>
        <div class="slot" onclick="removeItem(4)"></div>
        <div class="slot" onclick="removeItem(5)"></div>
    </div>

    <div class="analysis-box">
        <div class="table-container">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="color:#aaa;">ì´ ê°€ê²©</span>
                <span id="totalPrice" style="color:#ffd700; font-weight:bold;">0 G</span>
            </div>
            <table class="stat-table">
                <tbody id="statBody"><tr><td colspan="2" style="text-align:center; color:#555; padding:20px;">ì•„ì´í…œì„ ì„ íƒí•˜ì„¸ìš”.</td></tr></tbody>
            </table>
        </div>
        <div style="width:300px; height:300px; background:#010a13; padding:10px; border:1px solid #333; border-radius:8px;">
            <canvas id="statChart"></canvas>
        </div>
    </div>

    <div class="filter-tabs">
        <button class="tab-btn active" onclick="filterCategory('all')">ì „ì²´</button>
        <button class="tab-btn" onclick="filterCategory('Damage')">ë¬¼ë¦¬</button>
        <button class="tab-btn" onclick="filterCategory('SpellDamage')">ë§ˆë²•</button>
        <button class="tab-btn" onclick="filterCategory('Defense')">ë°©ì–´</button>
        <button class="tab-btn" onclick="filterCategory('Support')">ì„œí¿</button>
        <button class="tab-btn" onclick="filterCategory('Boots')">ì‹ ë°œ</button>
    </div>
    <div class="search-box">
        <input type="text" id="search" placeholder="ì•„ì´í…œ ì´ë¦„ ê²€ìƒ‰..." onkeyup="searchItems()">
    </div>
    <div class="item-list" id="itemList"></div>

    <script>
        // âœ… ëª©ì‚¬ë‹˜ì˜ ì‹œíŠ¸ ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”
        const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRP5NKa1wd_e47A5CT5klukKhbDPluILcBMObpJUyhPNNnd5rmMXpWSUfIFdmA4T_2BFxHF8dS7bkfU/pub?gid=0&single=true&output=csv";

        let allItems = [];
        let displayedItems = [];
        let myInventory = [null, null, null, null, null, null];
        let radarChart;
        let selectedTags = new Set(); // ì„ íƒëœ íƒœê·¸ ì €ì¥ì†Œ

        // 1. ë°ì´í„° ë¡œë“œ
        Papa.parse(GOOGLE_SHEET_URL, {
            download: true, header: true, dynamicTyping: true,
            complete: function(results) {
                // ì´ë¦„ ìˆëŠ” ê²ƒë§Œ í•„í„°ë§ + ë°ì´í„° í´ë Œì§•
                allItems = results.data.filter(i => i.name).map(i => {
                    // ìŠ¤í‚¬ê°€ì†(ah) ê°•ì œ ìˆ«ì ë³€í™˜ (ì—ëŸ¬ ë°©ì§€)
                    i.ah = Number(i.ah) || 0;
                    return i;
                });
                displayedItems = allItems;
                renderList();
                console.log("ë¡œë“œ ì™„ë£Œ: " + allItems.length);
            }
        });

        // 2. íƒœê·¸ í´ë¦­ ë¡œì§
        function toggleTag(el) {
            const stat = el.dataset.stat;
            if (selectedTags.has(stat)) {
                selectedTags.delete(stat);
                el.classList.remove('active');
            } else {
                selectedTags.add(stat);
                el.classList.add('active');
            }
        }

        // 3. ìŠ¤ë§ˆíŠ¸ ì•Œê³ ë¦¬ì¦˜ (íƒœê·¸ ê¸°ë°˜)
        function autoGenerateBuild() {
            if(selectedTags.size === 0) {
                alert("ì›í•˜ëŠ” ëŠ¥ë ¥ì¹˜ë¥¼ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            // ì ìˆ˜ ê³„ì‚° (ì„ íƒëœ íƒœê·¸ì— ê°€ì¤‘ì¹˜ ë¶€ì—¬)
            const calculateScore = (item) => {
                let score = 0;
                if(selectedTags.has('ad')) score += (item.ad || 0) * 1.5;
                if(selectedTags.has('ap')) score += (item.ap || 0) * 1.5;
                if(selectedTags.has('tank')) score += ((item.hp||0)/10 + (item.armor||0) + (item.mr||0));
                if(selectedTags.has('as')) score += (item.as || 0) * 100;
                if(selectedTags.has('crit')) score += (item.crit || 0) * 100;
                // ìŠ¤í‚¬ê°€ì† ê°€ì¤‘ì¹˜ 3ë°° (ìˆ˜ì¹˜ê°€ ì‘ìœ¼ë¯€ë¡œ)
                if(selectedTags.has('ah')) score += (item.ah || 0) * 3; 
                return score;
            };

            // ì‹ ë°œ ì œì™¸í•˜ê³  ì ìˆ˜ìˆœ ì •ë ¬
            const rankedItems = allItems
                .filter(i => i.category !== "Boots")
                .map(item => ({ item, score: calculateScore(item) }))
                .filter(i => i.score > 0) // ì ìˆ˜ ìˆëŠ” ê²ƒë§Œ
                .sort((a, b) => b.score - a.score);

            // ì‹ ë°œ ì¶”ì²œ ë¡œì§
            let bestBoot = "íŒê¸ˆ ì¥í™”";
            if (selectedTags.has('ap')) bestBoot = "ë§ˆë²•ì‚¬ì˜ ì‹ ë°œ";
            if (selectedTags.has('as')) bestBoot = "ê´‘ì „ì‚¬ì˜ êµ°í™”";
            if (selectedTags.has('ah')) bestBoot = "ëª…ì„í•¨ì˜ ì•„ì´ì˜¤ë‹ˆì•„ ì¥í™”";
            if (selectedTags.has('ad') && !selectedTags.has('as')) bestBoot = "íŒê¸ˆ ì¥í™”"; // ADë¸Œë£¨ì €

            myInventory = [null, null, null, null, null, null];
            let addedNames = new Set();

            // ì‹ ë°œ (6ë²ˆ ìŠ¬ë¡¯)
            const bootObj = allItems.find(i => i.name === bestBoot);
            if(bootObj) { myInventory[5] = bootObj; addedNames.add(bootObj.name); }

            // ë‚˜ë¨¸ì§€ ì±„ìš°ê¸° (ì¤‘ë³µ ë°©ì§€)
            let slot = 0;
            for(let i=0; i < rankedItems.length; i++) {
                if(slot >= 5) break;
                const cand = rankedItems[i].item;
                if(!addedNames.has(cand.name)) {
                    myInventory[slot] = cand;
                    addedNames.add(cand.name);
                    slot++;
                }
            }
            updateUI();
        }

        // 4. UI ì—…ë°ì´íŠ¸ (ìŠ¤í‚¬ê°€ì† í‘œì‹œ ë¡œì§ ê°•í™”)
        function updateUI() {
            const slots = document.querySelectorAll(".slot");
            let totalGold = 0;
            let stats = { "ê³µê²©ë ¥":0, "ì£¼ë¬¸ë ¥":0, "ì²´ë ¥":0, "ë°©ì–´ë ¥":0, "ë§ˆë²•ì €í•­":0, "ê³µì†":0, "ì¹˜ëª…íƒ€":0, "ì´ì†":0, "ìŠ¤í‚¬ê°€ì†": 0 };

            myInventory.forEach((item, i) => {
                slots[i].innerHTML = item ? `<img src="${item.img}" onmouseenter="showTooltip(myInventory[${i}], event)" onmousemove="moveTooltip(event)" onmouseleave="hideTooltip()">` : "";
                if(item) {
                    totalGold += (item.gold || 0);
                    stats["ê³µê²©ë ¥"] += item.ad || 0;
                    stats["ì£¼ë¬¸ë ¥"] += item.ap || 0;
                    stats["ì²´ë ¥"] += item.hp || 0;
                    stats["ë°©ì–´ë ¥"] += item.armor || 0;
                    stats["ë§ˆë²•ì €í•­"] += item.mr || 0;
                    stats["ê³µì†"] += item.as || 0;
                    stats["ì¹˜ëª…íƒ€"] += item.crit || 0;
                    stats["ì´ì†"] += item.ms || 0;
                    // ì—¬ê¸°ì„œ ì¤‘ìš”: item.ahê°€ ìˆìœ¼ë©´ ë”í•˜ê³  ì—†ìœ¼ë©´ 0
                    stats["ìŠ¤í‚¬ê°€ì†"] += (item.ah || 0);
                }
            });

            document.getElementById("totalPrice").innerText = totalGold.toLocaleString() + " G";
            const tbody = document.getElementById("statBody");
            tbody.innerHTML = "";
            
            for(let [k, v] of Object.entries(stats)) {
                if(v > 0) {
                    let displayV = v;
                    let rowClass = "";
                    if(k === "ê³µì†" || k === "ì¹˜ëª…íƒ€") displayV = (v * 100).toFixed(0) + "%";
                    
                    // ìŠ¤í‚¬ê°€ì† í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
                    if(k === "ìŠ¤í‚¬ê°€ì†") { 
                        rowClass = "highlight"; 
                        // ì¿¨ê° ê³µì‹: ì¿¨ê°% = ê°€ì† / (ê°€ì† + 100) * 100
                        let cdr = Math.floor((v / (v + 100)) * 100);
                        displayV = `${v} (ì¿¨ê° ${cdr}%)`; 
                    }

                    tbody.innerHTML += `<tr><td class="label ${rowClass}">${k}</td><td class="${rowClass}">+${displayV}</td></tr>`;
                }
            }
            updateChart(stats);
        }

        // ìœ í‹¸ í•¨ìˆ˜ë“¤
        function addItem(item) { const idx = myInventory.indexOf(null); if(idx > -1) { myInventory[idx] = item; updateUI(); } }
        function removeItem(idx) { myInventory[idx] = null; updateUI(); }
        function filterCategory(cat) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if(cat === 'all') displayedItems = allItems;
            else displayedItems = allItems.filter(i => i.category === cat);
            renderList();
        }
        function searchItems() {
            const key = document.getElementById("search").value;
            displayedItems = allItems.filter(i => i.name.includes(key));
            renderList();
        }
        function updateChart(s) {
            const ctx = document.getElementById('statChart').getContext('2d');
            const data = [s["ê³µê²©ë ¥"], s["ì£¼ë¬¸ë ¥"], s["ì²´ë ¥"]/10, s["ë°©ì–´ë ¥"], s["ë§ˆë²•ì €í•­"], s["ê³µì†"]*100];
            if(radarChart) { radarChart.data.datasets[0].data = data; radarChart.update(); }
            else {
                radarChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['ê³µê²©', 'ì£¼ë¬¸', 'ì²´ë ¥/10', 'ë°©ì–´', 'ë§ˆë°©', 'ê³µì†'],
                        datasets: [{ label: 'ìŠ¤íƒ¯ ë°¸ëŸ°ìŠ¤', data: data, backgroundColor: 'rgba(200, 170, 110, 0.2)', borderColor: '#c8aa6e', pointBackgroundColor: '#fff' }]
                    },
                    options: { scales: { r: { grid: { color: '#333' }, ticks: { display: false } } }, plugins: { legend: { display: false } } }
                });
            }
        }
        // íˆ´íŒ
        const tooltip = document.getElementById('tooltip');
        function showTooltip(item, e) {
            // íˆ´íŒì—ë„ ìŠ¤í‚¬ê°€ì† í‘œì‹œ
            let ahHtml = item.ah ? `<div class="stat-row" style="color:#00d2d3"><span>ìŠ¤í‚¬ê°€ì†</span><span class="stat-val">+${item.ah}</span></div>` : "";
            let adHtml = item.ad ? `<div class="stat-row"><span>ê³µê²©ë ¥</span><span class="stat-val">+${item.ad}</span></div>` : "";
            let apHtml = item.ap ? `<div class="stat-row"><span>ì£¼ë¬¸ë ¥</span><span class="stat-val">+${item.ap}</span></div>` : "";
            
            tooltip.innerHTML = `<h3>${item.name}</h3><span class="gold">ë¹„ìš©: ${item.gold} G</span>${adHtml}${apHtml}${ahHtml}`;
            tooltip.style.display = 'block'; moveTooltip(e);
        }
        function moveTooltip(e) {
            let left = e.clientX + 15;
            if(left + 260 > window.innerWidth) left = e.clientX - 275;
            tooltip.style.left = left + 'px'; tooltip.style.top = (e.clientY + 15) + 'px';
        }
        function hideTooltip() { tooltip.style.display = 'none'; }
        function renderList() {
            const div = document.getElementById("itemList"); div.innerHTML = "";
            displayedItems.forEach(i => {
                const img = document.createElement("img"); img.src = i.img; img.className = "item-card";
                img.onclick = () => addItem(i);
                img.onmouseenter = (e) => showTooltip(i, e); img.onmousemove = (e) => moveTooltip(e); img.onmouseleave = () => hideTooltip();
                div.appendChild(img);
            });
        }
        
        init();
    </script>
</body>
</html>
